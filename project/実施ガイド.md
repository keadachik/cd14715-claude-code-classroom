# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®Ÿæ–½ã‚¬ã‚¤ãƒ‰

ã“ã®ã‚¬ã‚¤ãƒ‰ã¯ã€ãƒ¬ãƒƒã‚¹ãƒ³ã§å­¦ã‚“ã å†…å®¹ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å®Ÿè£…ã«ç›´æ¥æ´»ã‹ã™ãŸã‚ã®å­¦ç¿’â†’å®Ÿè£…ãƒãƒƒãƒ”ãƒ³ã‚°ã§ã™ã€‚

## ğŸ“š å­¦ç¿’ã®æµã‚Œ

å„ãƒ¬ãƒƒã‚¹ãƒ³ã‚’å®Œäº†ã—ãŸã‚‰ã€å¯¾å¿œã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¹ã‚¯ã«é€²ã¿ã¾ã—ã‚‡ã†ã€‚ãƒ¬ãƒƒã‚¹ãƒ³ã§å­¦ã‚“ã çŸ¥è­˜ã‚’ã™ãã«å®Ÿè£…ã«æ´»ç”¨ã§ãã¾ã™ã€‚

---

## ğŸ¯ Phase 0: æº–å‚™ã¨ç’°å¢ƒè¨­å®š

### Lesson 01: Model Selection ã‚’å®Œäº†å¾Œ

**å­¦ç¿’å†…å®¹:**
- Claudeãƒ¢ãƒ‡ãƒ«ã®é¸æŠï¼ˆHaiku, Sonnet, Opusï¼‰
- AWS Bedrockã¨Anthropic APIã®èªè¨¼æ–¹æ³•
- ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¹ã‚¯: ç’°å¢ƒå¤‰æ•°ã®è¨­å®š**

1. **`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ**
   ```bash
   cd project/starter
   cp .env.example .env
   ```

2. **èªè¨¼æ–¹æ³•ã®é¸æŠã¨è¨­å®š**

   **Option A: AWS Bedrockï¼ˆVocareumæ¨å¥¨ï¼‰**
   ```env
   AWS_REGION=us-east-1
   AWS_ACCESS_KEY_ID=your-access-key-id
   AWS_SECRET_ACCESS_KEY=your-secret-access-key
   AWS_SESSION_TOKEN=your-session-token
   CLAUDE_CODE_USE_BEDROCK=1
   ANTHROPIC_MODEL=us.anthropic.claude-sonnet-4-5-20250929-v1:0
   ```

   **Option B: Anthropic API**
   ```env
   ANTHROPIC_API_KEY=sk-ant-your-key-here
   ANTHROPIC_MODEL=claude-sonnet-4-5-20250929
   ```

3. **GitHub Tokenã®è¨­å®šï¼ˆæ¨å¥¨ï¼‰**
   ```env
   GITHUB_TOKEN=ghp_your-token-here
   ```

4. **ãã®ä»–ã®è¨­å®š**
   ```env
   PROJECT_ROOT=/absolute/path/to/project/starter
   LOG_LEVEL=info
   ```

**ç¢ºèªäº‹é …:**
- [ ] `.env`ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] èªè¨¼æƒ…å ±ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] `ANTHROPIC_MODEL`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ï¼ˆå½¢å¼ã«æ³¨æ„ï¼šBedrockã¨APIã§ç•°ãªã‚‹ï¼‰

---

## ğŸ”§ Phase 1: MCPè¨­å®š

### Lesson 09: MCP Integration ã‚’å®Œäº†å¾Œ

**å­¦ç¿’å†…å®¹:**
- MCPï¼ˆModel Context Protocolï¼‰ã®åŸºæœ¬
- MCPã‚µãƒ¼ãƒãƒ¼ã®è¨­å®šæ–¹æ³•
- GitHub MCPã¨ESLint MCPã®ä½¿ç”¨æ–¹æ³•

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¹ã‚¯: MCPè¨­å®šã®å®Ÿè£…**

**ãƒ•ã‚¡ã‚¤ãƒ«:** `src/config/mcp.config.ts`

1. **GitHub MCPã‚µãƒ¼ãƒãƒ¼ã®è¨­å®š**
   ```typescript
   github: {
     type: 'stdio' as const,
     command: 'npx',
     args: ['-y', '@modelcontextprotocol/server-github'],
     env: {
       GITHUB_PERSONAL_ACCESS_TOKEN: process.env.GITHUB_TOKEN || ''
     }
   }
   ```

2. **ESLint MCPã‚µãƒ¼ãƒãƒ¼ã®è¨­å®š**
   ```typescript
   eslint: {
     type: 'stdio' as const,
     command: 'npx',
     args: ['-y', '@eslint/mcp@latest'],
     env: {}
   }
   ```

**ç¢ºèªäº‹é …:**
- [ ] GitHub MCPã‚µãƒ¼ãƒãƒ¼ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ESLint MCPã‚µãƒ¼ãƒãƒ¼ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ç’°å¢ƒå¤‰æ•°ã®ãƒãƒƒãƒ”ãƒ³ã‚°ãŒæ­£ã—ã„ï¼ˆ`GITHUB_TOKEN` â†’ `GITHUB_PERSONAL_ACCESS_TOKEN`ï¼‰

**å‚è€ƒ:**
- Lesson 09ã®demo/exerciseã§MCPè¨­å®šã®å®Ÿè£…ä¾‹ã‚’ç¢ºèª

---

## ğŸ¤– Phase 2: ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å®Ÿè£…

### Lesson 05: Agent SDK + Lesson 08: Claude Skills ã‚’å®Œäº†å¾Œ

**å­¦ç¿’å†…å®¹:**
- `query()`é–¢æ•°ã®ä½¿ã„æ–¹
- `allowedTools`ã®è¨­å®š
- éåŒæœŸã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ã§ã®çµæœå–å¾—
- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®šç¾©ã®åŸºæœ¬
- Claude Skillsã®åŸºæœ¬æ¦‚å¿µï¼ˆ`.claude/skills/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã€`Skill`ãƒ„ãƒ¼ãƒ«ï¼‰

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¹ã‚¯: ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å®Ÿè£…**

### Task 2.1: Code Quality Analyzer

**ãƒ•ã‚¡ã‚¤ãƒ«:** `src/agents/code-quality-analyzer.ts`

**Lesson 05ã§å­¦ã‚“ã ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é©ç”¨:**
```typescript
import { AgentDefinition } from '@anthropic-ai/claude-agent-sdk';

export const codeQualityAnalyzer: AgentDefinition = {
  name: 'code-quality-analyzer',
  description: 'Analyzes code for security vulnerabilities, performance issues, and maintainability concerns. Focuses on finding bugs, security flaws, and code smells.',
  model: 'inherit',
  tools: ['Read', 'Grep', 'Glob', 'Skill'], // Skillãƒ„ãƒ¼ãƒ«ã‚’å«ã‚ã‚‹
};
```

**ç¢ºèªäº‹é …:**
- [ ] `AgentDefinition`å‹ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹
- [ ] `description`ãŒæ˜ç¢ºã§ã€ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒä½¿ã„åˆ†ã‘ã§ãã‚‹
- [ ] `model: 'inherit'`ã‚’è¨­å®šã—ã¦ã„ã‚‹
- [ ] `Skill`ãƒ„ãƒ¼ãƒ«ã‚’å«ã‚“ã§ã„ã‚‹

### Task 2.2: Test Coverage Analyzer

**ãƒ•ã‚¡ã‚¤ãƒ«:** `src/agents/test-coverage-analyzer.ts`

**Lesson 02: Extended Thinking ã®çŸ¥è­˜ã‚’æ´»ç”¨:**
- ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸åˆ†æã«ã¯è¤‡é›‘ãªæ¨è«–ãŒå¿…è¦
- Extended Thinkingã‚’ä½¿ç”¨ã—ã¦ã€ãƒ†ã‚¹ãƒˆã®æ¬ è½ã‚’ç‰¹å®š

```typescript
export const testCoverageAnalyzer: AgentDefinition = {
  name: 'test-coverage-analyzer',
  description: 'Evaluates test completeness and suggests specific test cases. Identifies untested code paths and prioritizes critical test scenarios.',
  model: 'inherit',
  tools: ['Read', 'Grep', 'Glob'],
};
```

### Task 2.3: Refactoring Suggester

**ãƒ•ã‚¡ã‚¤ãƒ«:** `src/agents/refactoring-suggester.ts`

```typescript
export const refactoringSuggester: AgentDefinition = {
  name: 'refactoring-suggester',
  description: 'Identifies opportunities to improve code structure, modernize patterns, and apply design principles. Suggests extract method/class candidates and dead code removal.',
  model: 'inherit',
  tools: ['Read', 'Grep', 'Glob'],
};
```

**ç¢ºèªäº‹é …:**
- [ ] 3ã¤ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®šç¾©ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«é©åˆ‡ãª`description`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] `src/agents/index.ts`ã§å…¨ã¦ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹

---

## ğŸ“ Phase 3: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å®Ÿè£…

### Lesson 04: Claude Code Config ã‚’å®Œäº†å¾Œ

**å­¦ç¿’å†…å®¹:**
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆã®åŸºæœ¬
- ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ›¸ãæ–¹
- å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®æŒ‡å®šæ–¹æ³•

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¹ã‚¯: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å®Ÿè£…**

### Task 3.1: Code Quality Analyzer ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«:** `src/prompts/code-quality-analyzer.prompt.ts`

**Lesson 04ã§å­¦ã‚“ã ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆåŸå‰‡ã‚’é©ç”¨:**
- å…·ä½“çš„ãªã‚¿ã‚¹ã‚¯ã®æŒ‡å®š
- å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®æ˜ç¤º
- è©•ä¾¡åŸºæº–ã®æä¾›
- ãƒ„ãƒ¼ãƒ«ä½¿ç”¨ã®æŒ‡ç¤º

```typescript
export const codeQualityAnalyzerPrompt = `You are a code quality expert analyzing code for security, performance, and maintainability issues.

TASK:
1. Read the provided code files using the Read tool
2. Use Claude Skills (javascript-best-practices, security-analysis) for specialized analysis
3. Identify issues with severity levels: critical, high, medium, low
4. Provide specific file paths and line numbers

OUTPUT FORMAT:
Return a JSON object matching the CodeQualityResultSchema:
{
  "issues": [
    {
      "type": "security" | "performance" | "maintainability",
      "severity": "critical" | "high" | "medium" | "low",
      "file": "path/to/file.ts",
      "line": 42,
      "message": "Description of the issue",
      "suggestion": "How to fix it"
    }
  ],
  "overallScore": 85
}

EVALUATION CRITERIA:
- Critical: Security vulnerabilities, data leaks, SQL injection
- High: Performance bottlenecks, memory leaks
- Medium: Code smells, maintainability issues
- Low: Style inconsistencies, minor improvements
`;
```

### Task 3.2: Test Coverage Analyzer ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«:** `src/prompts/test-coverage-analyzer.prompt.ts`

**Lesson 02ã®Extended Thinkingã‚’æ´»ç”¨:**
```typescript
export const testCoverageAnalyzerPrompt = `You are a test coverage expert. Use extended thinking to deeply analyze code and identify untested paths.

TASK:
1. Read source files and corresponding test files
2. Compare source code with test files to identify gaps
3. Use extended thinking to reason through all code paths
4. Prioritize critical untested scenarios

OUTPUT FORMAT:
{
  "untestedPaths": [
    {
      "file": "src/payment.ts",
      "function": "processPayment",
      "reason": "Edge case: invalid card number",
      "priority": "high",
      "suggestedTest": "Test with invalid card numbers"
    }
  ],
  "coverageEstimate": 75
}
`;
```

### Task 3.3: Refactoring Suggester ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«:** `src/prompts/refactoring-suggester.prompt.ts`

```typescript
export const refactoringSuggesterPrompt = `You are a refactoring expert identifying opportunities to improve code structure.

TASK:
1. Analyze code for modernization opportunities
2. Identify design pattern applications
3. Find extract method/class candidates
4. Detect dead code and redundant logic

OUTPUT FORMAT:
{
  "suggestions": [
    {
      "type": "extract_method" | "apply_pattern" | "modernize",
      "file": "src/utils.ts",
      "line": 50,
      "description": "Extract this logic into a separate function",
      "before": "current code",
      "after": "refactored code",
      "impact": "high" | "medium" | "low"
    }
  ]
}
`;
```

### Task 3.4: Orchestrator ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«:** `src/prompts/orchestrator.prompt.ts`

**Lesson 03: Agentic Architecture ã®çŸ¥è­˜ã‚’æ´»ç”¨:**
- ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- ä¸¦åˆ—å®Ÿè¡Œ vs é †æ¬¡å®Ÿè¡Œ
- çµæœã®é›†ç´„

```typescript
export const orchestratorPrompt = (owner: string, repo: string, prNumber: number) => `You are the main orchestrator for a code review system.

TASK:
1. Fetch pull request data using GitHub MCP tools:
   - Use mcp__github__get_pull_request to get PR details
   - Use mcp__github__list_pull_request_files to get changed files
2. For each changed file, invoke all three subagents in parallel:
   - Use the code-quality-analyzer agent to analyze security/performance
   - Use the test-coverage-analyzer agent to evaluate test completeness
   - Use the refactoring-suggester agent to identify improvements
3. Aggregate all results into a single ReviewReport

EXPLICIT INVOCATION:
- "Use the code-quality-analyzer agent to analyze src/payment.ts"
- "Use the test-coverage-analyzer agent to evaluate tests for src/payment.ts"
- "Use the refactoring-suggester agent to suggest improvements for src/payment.ts"

OUTPUT FORMAT:
Return a JSON object matching ReviewReportSchema with:
- pullRequest: { owner, repo, number }
- fileReviews: Array of analysis results per file
- summary: Aggregated scores and counts
- recommendations: High-level suggestions
`;
```

**ç¢ºèªäº‹é …:**
- [ ] 4ã¤ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] å„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒZodã‚¹ã‚­ãƒ¼ãƒã‚’å‚ç…§ã—ã¦ã„ã‚‹
- [ ] ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒæ˜ç¤ºçš„ãªå‘¼ã³å‡ºã—ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹
- [ ] `src/prompts/index.ts`ã§å…¨ã¦ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹

---

## ğŸ¼ Phase 4: ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã®å®Ÿè£…

### Lesson 05: Agent SDK + Lesson 08: Claude Skills + Lesson 10: Multi-Agent Orchestration ã‚’å®Œäº†å¾Œ

**å­¦ç¿’å†…å®¹:**
- `query()`é–¢æ•°ã®è©³ç´°ãªä½¿ã„æ–¹
- `agents`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã®ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç™»éŒ²
- `Task`ãƒ„ãƒ¼ãƒ«ã§ã®ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆèµ·å‹•
- æ§‹é€ åŒ–å‡ºåŠ›ã®è¨­å®š
- çµæœã®é›†ç´„
- Claude Skillsã®èª­ã¿è¾¼ã¿è¨­å®šï¼ˆ`cwd`ã¨`settingSources`ï¼‰

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¹ã‚¯: ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã®å®Ÿè£…**

**ãƒ•ã‚¡ã‚¤ãƒ«:** `src/orchestrator.ts`

### Task 4.1: åŸºæœ¬çš„ãªå®Ÿè£…

**Lesson 05ã§å­¦ã‚“ã ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ‹¡å¼µ:**
```typescript
import { query } from '@anthropic-ai/claude-agent-sdk';
import { zodToJsonSchema } from 'zod-to-json-schema';
import { ReviewReportSchema } from './types/report-types.js';
import { codeQualityAnalyzer, testCoverageAnalyzer, refactoringSuggester } from './agents/index.js';
import { orchestratorPrompt } from './prompts/index.js';
import { mcpServersConfig } from './config/mcp.config.js';
import path from 'path';
import { fileURLToPath } from 'url';

const __dirname = path.dirname(fileURLToPath(import.meta.url));
// Lesson 08: Claude Skills ã§å­¦ã¶è¨­å®š
// .claude/skills/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å ´æ‰€ã‚’æŒ‡å®š
const PROJECT_ROOT = process.env.PROJECT_ROOT || path.resolve(__dirname, '../..');

export class CodeReviewOrchestrator {
  async reviewPullRequest(
    owner: string,
    repo: string,
    prNumber: number
  ): Promise<ReviewReport> {
    const model = process.env.ANTHROPIC_MODEL;
    if (!model) {
      throw new Error('ANTHROPIC_MODEL is not set');
    }

    // Lesson 07: Structured Outputs ã§å­¦ã¶å†…å®¹ã‚’é©ç”¨
    const jsonSchema = zodToJsonSchema(ReviewReportSchema, {
      $refStrategy: 'root'
    });

    const result = query({
      prompt: orchestratorPrompt(owner, repo, prNumber),
      options: {
        model,
        // Lesson 08: Claude Skills ã§å­¦ã¶è¨­å®š
        cwd: PROJECT_ROOT,                    // .claude/skills/ ã®å ´æ‰€ã‚’æŒ‡å®š
        settingSources: ["project"],          // Skillsã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰èª­ã¿è¾¼ã‚€
        agents: [
          codeQualityAnalyzer,
          testCoverageAnalyzer,
          refactoringSuggester
        ],
        allowedTools: [
          'Task', // ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆèµ·å‹•ã«å¿…é ˆ
          'mcp__github__get_pull_request',
          'mcp__github__list_pull_request_files',
          'mcp__eslint__lint',
          'Read',
          'Grep',
          'Glob',
          'Skill' // Skillsã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«å¿…è¦
        ],
        mcpServers: mcpServersConfig,
        outputFormat: {
          type: 'json_schema',
          json_schema: jsonSchema
        },
        maxTurns: 20, // ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã¯ååˆ†ãªã‚¿ãƒ¼ãƒ³æ•°ãŒå¿…è¦
        permissionMode: 'auto' // CI/CDç”¨é€”
      }
    });

    // Lesson 05ã§å­¦ã‚“ã éåŒæœŸã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ãƒ‘ã‚¿ãƒ¼ãƒ³
    for await (const message of result) {
      if (message.type === 'result' && message.subtype === 'success') {
        // æ§‹é€ åŒ–å‡ºåŠ›ã®å–å¾—
        const structuredOutput = message.structured_output;
        if (structuredOutput) {
          // Zodã‚¹ã‚­ãƒ¼ãƒã§æ¤œè¨¼
          const parseResult = ReviewReportSchema.safeParse(structuredOutput);
          if (parseResult.success) {
            return parseResult.data;
          } else {
            throw new Error(`Schema validation failed: ${parseResult.error.message}`);
          }
        }
      }
    }

    throw new Error('No result received from orchestrator');
  }
}
```

**ç¢ºèªäº‹é …:**
- [ ] `query()`é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹
- [ ] `agents`é…åˆ—ã«3ã¤ã®ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹
- [ ] `Task`ãƒ„ãƒ¼ãƒ«ãŒ`allowedTools`ã«å«ã¾ã‚Œã¦ã„ã‚‹
- [ ] `Skill`ãƒ„ãƒ¼ãƒ«ãŒ`allowedTools`ã«å«ã¾ã‚Œã¦ã„ã‚‹ï¼ˆLesson 08ï¼‰
- [ ] `cwd: PROJECT_ROOT`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ï¼ˆLesson 08ï¼‰
- [ ] `settingSources: ["project"]`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ï¼ˆLesson 08ï¼‰
- [ ] MCPã‚µãƒ¼ãƒãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] æ§‹é€ åŒ–å‡ºåŠ›ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] Zodã‚¹ã‚­ãƒ¼ãƒã§çµæœã‚’æ¤œè¨¼ã—ã¦ã„ã‚‹

---

## ğŸ› ï¸ Phase 5: ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã®å®Ÿè£…

### Lesson 05: Agent SDK ã®å¿œç”¨

**å­¦ç¿’å†…å®¹:**
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¹ã‚¯: ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®å®Ÿè£…**

### Task 5.1: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼

**ãƒ•ã‚¡ã‚¤ãƒ«:** `src/utils/error-handler.ts`

**å®Ÿè£…ã™ã¹ãæ©Ÿèƒ½:**
1. **`withRetry`é–¢æ•°** - æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ä»˜ããƒªãƒˆãƒ©ã‚¤
2. **`withTimeout`é–¢æ•°** - `Promise.race`ã‚’ä½¿ç”¨ã—ãŸã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

```typescript
// æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ã®å®Ÿè£…ä¾‹
export async function withRetry<T>(
  fn: () => Promise<T>,
  options: RetryOptions
): Promise<T> {
  const { maxRetries = 3, delayMs = 1000 } = options;
  
  for (let attempt = 1; attempt <= maxRetries; attempt++) {
    try {
      return await fn();
    } catch (error) {
      if (attempt === maxRetries) {
        throw error;
      }
      // æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•: delayMs * 2^(attempt - 1)
      const backoffDelay = delayMs * Math.pow(2, attempt - 1);
      // ã‚¸ãƒƒã‚¿ãƒ¼è¿½åŠ ï¼ˆ0-100msã®ãƒ©ãƒ³ãƒ€ãƒ ï¼‰
      const jitter = Math.random() * 100;
      await new Promise(resolve => setTimeout(resolve, backoffDelay + jitter));
    }
  }
  throw new Error('Retry exhausted');
}

// ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®å®Ÿè£…ä¾‹
export async function withTimeout<T>(
  fn: () => Promise<T>,
  timeoutMs: number
): Promise<T> {
  return Promise.race([
    fn(),
    new Promise<T>((_, reject) => 
      setTimeout(() => reject(new Error('Timeout')), timeoutMs)
    )
  ]);
}
```

### Task 5.2: ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒã‚¿ãƒ¼

**ãƒ•ã‚¡ã‚¤ãƒ«:** `src/utils/rate-limiter.ts`

**å®Ÿè£…ã™ã¹ãæ©Ÿèƒ½:**
- ã‚¹ãƒ©ã‚¤ãƒ‡ã‚£ãƒ³ã‚°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆè¿½è·¡
- ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ã®è¿½è·¡
- åŒæ™‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã®åˆ¶é™

**ç¢ºèªäº‹é …:**
- [ ] `pruneOldRecords()` - 60ç§’ã‚ˆã‚Šå¤ã„ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤
- [ ] `canProceed()` - ãƒªã‚¯ã‚¨ã‚¹ãƒˆå¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
- [ ] `acquire()` - ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å–å¾—
- [ ] `release()` - ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®è§£æ”¾

---

## ğŸ–¥ï¸ Phase 6: CLIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…

### Lesson 05: Agent SDK ã®å¿œç”¨

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¹ã‚¯: CLIã®å®Ÿè£…**

**ãƒ•ã‚¡ã‚¤ãƒ«:** `src/main.ts`

### Task 6.1: å¼•æ•°æ¤œè¨¼

```typescript
// ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã®æ¤œè¨¼
const [owner, repo, prStr] = process.argv.slice(2);

if (!owner || !repo || !prStr) {
  console.error('Usage: npm run dev <owner> <repo> <pr-number>');
  process.exit(1);
}

const prNumber = parseInt(prStr, 10);
if (isNaN(prNumber) || prNumber <= 0) {
  console.error('Error: PR number must be a positive integer');
  process.exit(1);
}
```

### Task 6.2: èªè¨¼æ¤œè¨¼

```typescript
// èªè¨¼æ–¹æ³•ã®æ¤œè¨¼
const hasAnthropicKey = !!process.env.ANTHROPIC_API_KEY;
const hasAwsCredentials = !!(
  process.env.AWS_ACCESS_KEY_ID && 
  process.env.AWS_SECRET_ACCESS_KEY
);

if (!hasAnthropicKey && !hasAwsCredentials) {
  console.error('Error: Authentication required');
  console.error('Set either ANTHROPIC_API_KEY or AWS credentials');
  process.exit(1);
}

if (hasAwsCredentials && !process.env.AWS_REGION) {
  console.error('Error: AWS_REGION is required when using AWS credentials');
  process.exit(1);
}

console.log(hasAwsCredentials 
  ? 'ğŸ” Using AWS Bedrock authentication'
  : 'ğŸ” Using Anthropic API authentication'
);
```

### Task 6.3: ãƒ¢ãƒ‡ãƒ«æ¤œè¨¼

```typescript
if (!process.env.ANTHROPIC_MODEL) {
  console.error('Error: ANTHROPIC_MODEL is required');
  console.error('For AWS Bedrock: us.anthropic.claude-sonnet-4-5-20250929-v1:0');
  console.error('For Anthropic API: claude-sonnet-4-5-20250929');
  process.exit(1);
}
```

### Task 6.4: ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Ÿè¡Œã¨ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

```typescript
try {
  const orchestrator = new CodeReviewOrchestrator();
  const report = await orchestrator.reviewPullRequest(owner, repo, prNumber);
  
  // ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
  const reportGenerator = new ReportGenerator();
  const filename = `${owner}_${repo}_${prNumber}`;
  
  await reportGenerator.generateJSON(report, `reports/${filename}.json`);
  await reportGenerator.generateMarkdown(report, `reports/${filename}.md`);
  await reportGenerator.generateHTML(report, `reports/${filename}.html`);
  
  console.log(`âœ… Reports generated in reports/ directory`);
} catch (error) {
  console.error('Error:', error instanceof Error ? error.message : error);
  process.exit(1);
}
```

**ç¢ºèªäº‹é …:**
- [ ] ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã®æ¤œè¨¼
- [ ] PRç•ªå·ãŒæ­£ã®æ•´æ•°ã‹æ¤œè¨¼
- [ ] èªè¨¼æ–¹æ³•ã®æ¤œè¨¼
- [ ] ãƒ¢ãƒ‡ãƒ«ç’°å¢ƒå¤‰æ•°ã®æ¤œè¨¼
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒé©åˆ‡
- [ ] 3ã¤ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

---

## ğŸ§ª Phase 7: ãƒ†ã‚¹ãƒˆã®å®Ÿè£…

### Lesson 05: Agent SDK ã®ç†è§£ã‚’æ·±ã‚ã‚‹

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¹ã‚¯: ãƒ†ã‚¹ãƒˆã®å®Ÿè£…**

**ãƒ•ã‚¡ã‚¤ãƒ«:** `tests/schemas.test.ts`

### Task 7.1: ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼ãƒ†ã‚¹ãƒˆ

```typescript
import { describe, it, expect } from 'vitest';
import { CodeQualityResultSchema, TestCoverageResultSchema, RefactoringResultSchema } from '../src/types/index.js';

describe('Schema Validation', () => {
  it('should accept valid CodeQualityResult', () => {
    const validData = {
      issues: [
        {
          type: 'security',
          severity: 'high',
          file: 'src/payment.ts',
          line: 42,
          message: 'Potential SQL injection',
          suggestion: 'Use parameterized queries'
        }
      ],
      overallScore: 85
    };
    
    expect(() => CodeQualityResultSchema.parse(validData)).not.toThrow();
  });
  
  it('should reject invalid CodeQualityResult', () => {
    const invalidData = {
      issues: [],
      overallScore: 150 // ã‚¹ã‚³ã‚¢ã¯0-100ã®ç¯„å›²å¤–
    };
    
    expect(() => CodeQualityResultSchema.parse(invalidData)).toThrow();
  });
});
```

**ç¢ºèªäº‹é …:**
- [ ] æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ã®ãƒ†ã‚¹ãƒˆ
- [ ] ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿ã®ãƒ†ã‚¹ãƒˆ
- [ ] ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆï¼ˆç©ºé…åˆ—ã€å¢ƒç•Œå€¤ï¼‰
- [ ] JSONã‚¹ã‚­ãƒ¼ãƒã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã®ãƒ†ã‚¹ãƒˆ

---

## ğŸ“Š Phase 8: æœ€çµ‚æˆæœç‰©ã®ç”Ÿæˆ

### å…¨ãƒ¬ãƒƒã‚¹ãƒ³å®Œäº†å¾Œ

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¹ã‚¯: æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ**

### Task 8.1: ãƒ†ã‚¹ãƒˆãƒªãƒã‚¸ãƒˆãƒªã®PRåˆ†æ

**ãƒªãƒã‚¸ãƒˆãƒª:** `airaamane/simple-todo-app`

```bash
# PR #1ã®åˆ†æ
npm run dev -- airaamane simple-todo-app 1

# PR #2ã®åˆ†æ
npm run dev -- airaamane simple-todo-app 2

# PR #3ã®åˆ†æ
npm run dev -- airaamane simple-todo-app 3
```

### Task 8.2: ãƒ¬ãƒãƒ¼ãƒˆã®ç¢ºèª

**å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆåˆè¨ˆ9ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰:**
```
reports/
â”œâ”€â”€ airaamane_simple-todo-app_1.json
â”œâ”€â”€ airaamane_simple-todo-app_1.md
â”œâ”€â”€ airaamane_simple-todo-app_1.html
â”œâ”€â”€ airaamane_simple-todo-app_2.json
â”œâ”€â”€ airaamane_simple-todo-app_2.md
â”œâ”€â”€ airaamane_simple-todo-app_2.html
â”œâ”€â”€ airaamane_simple-todo-app_3.json
â”œâ”€â”€ airaamane_simple-todo-app_3.md
â””â”€â”€ airaamane_simple-todo-app_3.html
```

**ç¢ºèªäº‹é …:**
- [ ] å…¨9ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹
- [ ] JSONãƒ•ã‚¡ã‚¤ãƒ«ãŒæœ‰åŠ¹ãªJSONå½¢å¼
- [ ] ãƒ¬ãƒãƒ¼ãƒˆã«æ„å‘³ã®ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã¦ã„ã‚‹ï¼ˆç©ºã‚„undefinedã§ãªã„ï¼‰
- [ ] ã‚³ãƒ¼ãƒ‰å“è³ªã®å•é¡ŒãŒç‰¹å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®åˆ†æãŒå«ã¾ã‚Œã¦ã„ã‚‹
- [ ] ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®ææ¡ˆãŒå«ã¾ã‚Œã¦ã„ã‚‹

---

## ğŸ“‹ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1: MCPè¨­å®š
- [ ] `src/config/mcp.config.ts`ã§GitHub MCPã‚’è¨­å®š
- [ ] `src/config/mcp.config.ts`ã§ESLint MCPã‚’è¨­å®š

### Phase 2: ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
- [ ] `src/agents/code-quality-analyzer.ts`ã‚’ä½œæˆ
- [ ] `src/agents/test-coverage-analyzer.ts`ã‚’ä½œæˆ
- [ ] `src/agents/refactoring-suggester.ts`ã‚’ä½œæˆ
- [ ] `src/agents/index.ts`ã§å…¨ã¦ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

### Phase 3: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
- [ ] `src/prompts/code-quality-analyzer.prompt.ts`ã‚’ä½œæˆ
- [ ] `src/prompts/test-coverage-analyzer.prompt.ts`ã‚’ä½œæˆ
- [ ] `src/prompts/refactoring-suggester.prompt.ts`ã‚’ä½œæˆ
- [ ] `src/prompts/orchestrator.prompt.ts`ã‚’ä½œæˆ
- [ ] `src/prompts/index.ts`ã§å…¨ã¦ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

### Phase 4: ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼
- [ ] `src/orchestrator.ts`ã§`query()`ã‚’å®Ÿè£…
- [ ] 3ã¤ã®ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ç™»éŒ²
- [ ] `Task`ãƒ„ãƒ¼ãƒ«ã‚’å«ã‚ã‚‹
- [ ] æ§‹é€ åŒ–å‡ºåŠ›ã‚’è¨­å®š
- [ ] çµæœã®æ¤œè¨¼ã‚’å®Ÿè£…

### Phase 5: ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- [ ] `src/utils/error-handler.ts`ã§`withRetry`ã‚’å®Ÿè£…
- [ ] `src/utils/error-handler.ts`ã§`withTimeout`ã‚’å®Ÿè£…
- [ ] `src/utils/rate-limiter.ts`ã®å…¨ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…

### Phase 6: CLI
- [ ] `src/main.ts`ã§å¼•æ•°æ¤œè¨¼ã‚’å®Ÿè£…
- [ ] `src/main.ts`ã§èªè¨¼æ¤œè¨¼ã‚’å®Ÿè£…
- [ ] `src/main.ts`ã§ãƒ¢ãƒ‡ãƒ«æ¤œè¨¼ã‚’å®Ÿè£…
- [ ] `src/main.ts`ã§ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚’å®Ÿè£…

### Phase 7: ãƒ†ã‚¹ãƒˆ
- [ ] `tests/schemas.test.ts`ã§ã‚¹ã‚­ãƒ¼ãƒãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…
- [ ] å…¨ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹

### Phase 8: æœ€çµ‚æˆæœç‰©
- [ ] 9ã¤ã®ãƒ¬ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
- [ ] ãƒ¬ãƒãƒ¼ãƒˆã®å“è³ªã‚’ç¢ºèª

---

## ğŸš€ å®Ÿè£…ã®é€²ã‚æ–¹

1. **ãƒ¬ãƒƒã‚¹ãƒ³ã‚’å®Œäº†ã™ã‚‹** â†’ å¯¾å¿œã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¹ã‚¯ã«é€²ã‚€
2. **å°ã•ãå§‹ã‚ã‚‹** â†’ ã¾ãšåŸºæœ¬çš„ãªå®Ÿè£…ã‚’å®Œæˆã•ã›ã‚‹
3. **ãƒ†ã‚¹ãƒˆã—ãªãŒã‚‰é€²ã‚ã‚‹** â†’ å„ãƒ•ã‚§ãƒ¼ã‚ºã§å‹•ä½œç¢ºèª
4. **ã‚¨ãƒ©ãƒ¼ã‚’ç†è§£ã™ã‚‹** â†’ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰å­¦ã¶
5. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã™ã‚‹** â†’ å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ´»ç”¨

## ğŸ’¡ ãƒ’ãƒ³ãƒˆ

- **Lesson 05ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å†åˆ©ç”¨**: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè£…ã®åŸºæœ¬ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯åŒã˜
- **Zodã‚¹ã‚­ãƒ¼ãƒã‚’å‚ç…§**: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§æœŸå¾…ã™ã‚‹å‡ºåŠ›å½¢å¼ã‚’æ˜ç¢ºã«
- **æ˜ç¤ºçš„ãªå‘¼ã³å‡ºã—**: ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯ã€ŒUse the X agentã€ã¨æ˜ç¤ºçš„ã«æŒ‡ç¤º
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: å„ãƒ•ã‚§ãƒ¼ã‚ºã§é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å®Ÿè£…

## ğŸ“š å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

- [Claude Agent SDK Documentation](https://docs.anthropic.com/claude/docs/agent-sdk)
- [MCP Servers Repository](https://github.com/modelcontextprotocol/servers)
- [Zod Documentation](https://zod.dev/)

---

**Good luck with your implementation! ğŸ‰**
